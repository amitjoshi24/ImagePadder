<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Padder</title>
    <!-- PyScript dependencies removed -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Basic styling for a clean, modern UI */
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 20px;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        .app-layout {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        @media (min-width: 768px) {
            .app-layout {
                flex-direction: row;
                gap: 20px;
            }
            .controls-panel {
                flex: 1;
                max-width: 400px;
                padding-right: 10px;
                box-sizing: border-box;
            }
            .result-panel {
                flex: 2;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                padding-top: 1rem;
            }
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="file"],
        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .color-picker-container {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .color-picker-container label {
            margin-right: 10px;
            margin-bottom: 0;
        }
        input[type="color"] {
            height: 40px;
            width: 60px;
            padding: 2px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }
        input[type="color"]:hover {
            box-shadow: 0 0 8px rgba(0,0,0,0.2);
            transform: scale(1.05);
        }
        .color-picker-hint {
            display: block;
            font-size: 12px;
            color: #666;
            margin-top: 4px;
            font-style: italic;
        }
        .color-preview {
            width: 40px;
            height: 40px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-left: 10px;
        }
        .color-hex {
            margin-left: 10px;
            font-family: monospace;
        }
        .form-group {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 6px;
            background-color: #f9f9f9;
            box-sizing: border-box;
        }
        button {
            background-color: #4285F4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background-color: #3367D6;
        }
        .error {
            color: red;
            margin-bottom: 10px;
        }
        .result-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        .image-container {
            position: relative;
            margin-top: 20px;
            border-radius: 0.25rem;
            overflow: visible;
            display: inline-block;
            width: 100%;
            max-width: 100%;
            text-align: center;
            padding-bottom: 50px; /* Add space for slideshow controls */
        }
        .image-wrapper {
            position: relative;
            min-height: 300px;  /* Minimum height to ensure controls don't jump */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .image-container img {
            display: block;
            max-width: 100%;
            max-height: 80vh;
            margin-bottom: 0; /* Remove margin since we're using container padding */
            object-fit: contain;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .download-button {
            background-color: #34A853;
            color: white;
            text-decoration: none;
            padding: 12px 30px;
            margin-bottom: 15px;
            display: inline-block;
            margin-top: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            border: none;
            font-size: 17px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            min-width: 160px;
            box-sizing: border-box;
        }
        .download-button:hover {
            background-color: #2E8B57;
        }
        .credits {
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
            color: #777;
        }
        .credits a {
            color: #4285F4;
            text-decoration: none;
        }
        .section-title {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 15px;
            color: #555;
        }
        .placeholder-message {
            text-align: center;
            padding: 40px;
            color: #777;
            font-style: italic;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px dashed #ccc;
        }
        .aspect-ratio-hint {
            font-size: 13px;
            color: #666;
            margin-top: -5px;
            margin-bottom: 8px;
            font-style: italic;
        }
        /* Prominent loading spinner styles */
        .loading-spinner {
            display: none;
            text-align: center;
            margin: 1.5rem 0;
        }
        
        .spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 0.25rem solid rgba(66, 133, 244, 0.3);
            border-radius: 50%;
            border-top-color: #4285F4;
            animation: spin 1s ease-in-out infinite;
        }
        
        .loading-text {
            margin-top: 0.5rem;
            color: #666;
            font-size: 0.9rem;
        }
        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
            margin-bottom: -1px;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .padding-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .padding-inputs label {
            margin-bottom: 3px;
        }
        .padding-inputs input {
            width: 100%;
        }
        /* Updated padding inputs style for vertical layout */
        .padding-vertical {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .padding-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .padding-row label {
            flex: 1;
            margin-bottom: 0;
        }
        
        .padding-row input {
            width: 80px;
            height: 30px;
            font-size: 16px;
            text-align: center;
        }
        /* Add this CSS for the transparency checkbox */
        .transparency-option {
            margin-top: 10px;
            display: flex;
            align-items: center;
        }

        .transparency-option input[type="checkbox"] {
            margin-right: 8px;
            width: auto;
        }

        .transparency-option label {
            display: inline;
            margin-bottom: 0;
        }

        .transparency-hint {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
            font-style: italic;
            margin-left: 22px;
        }
        /* Donation section styling */
        .donation-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #eee;
        }
        
        .donation-title {
            font-size: 16px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .donation-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .donation-button {
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            color: white;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }
        
        .donation-button:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        
        .donation-button i {
            margin-right: 8px;
        }
        
        .paypal-button {
            background-color: #0070ba;
        }
        
        .venmo-button {
            background-color: #008CFF;
        }
        /* Add back the Ko-fi button style */
        .ko-fi-button {
            background-color: #FF5E5B;
        }
        /* Add this CSS for custom file input styling */
        .custom-file-input {
            position: relative;
            display: inline-block;
            width: 100%;
            margin-bottom: 10px;
        }

        .custom-file-input-label {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background-color: #f5f5f5;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .custom-file-input-label:hover {
            background-color: #e9e9e9;
        }

        .custom-file-input-label i {
            margin-right: 10px;
            color: #4285F4;
            font-size: 18px;
        }

        .custom-file-input-label span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .custom-file-input input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-name {
            margin-left: 5px;
            font-weight: normal;
            color: #555;
        }

        .no-file {
            color: #999;
            font-style: italic;
        }
        /* Add this CSS for the opacity slider */
        .opacity-control {
            margin-top: 10px;
            margin-left: 22px;
            display: none; /* Hidden by default */
        }

        .opacity-slider-container {
            display: flex;
            align-items: center;
            margin-top: 5px;
            gap: 10px;
        }

        .opacity-slider {
            flex: 1;
        }

        .opacity-value {
            width: 40px;
            text-align: center;
            font-family: monospace;
        }

        /* Add CSS to make the checkbox larger and more mobile-friendly */
        #transparent-bg {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: #4285F4;
        }

        /* Make the label for the checkbox larger too for better touch targets */
        .transparency-option label {
            font-size: 16px;
            padding: 5px 0;
            cursor: pointer;
        }

        /* Improve touch area */
        .transparency-option {
            padding: 5px 0;
        }
        /* Update aspect ratio selection styling */
        .aspect-ratio-selection {
            margin-top: 15px;
        }

        .aspect-ratio-preset {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fff;
            font-size: 16px;
        }

        .custom-ratio-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .ratio-label {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 0;
            margin-right: 5px;
        }

        .ratio-input {
            width: 60px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            text-align: center;
        }

        .ratio-separator {
            font-size: 24px;
            font-weight: bold;
            margin: 0 5px;
        }

        /* Fix the spinner animation */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Additional slideshow styles */
        .slideshow-button:hover {
            background: rgba(255,255,255,0.3) !important;
        }
        
        .slideshow-button:disabled {
            opacity: 0.5;
            cursor: not-allowed !important;
        }
        
        #image-counter {
            padding: 5px 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            min-width: 60px;
            text-align: center;
        }

        /* Fixed slideshow controls positioning */
        .image-wrapper {
            position: relative;
            min-height: 300px;  /* Minimum height to ensure controls don't jump */
            display: flex;
            justify-content: center;
        }
        
        #slideshow-controls {
            position: relative;
            background: #333;
            padding: 12px;
            border-radius: 0 0 4px 4px;
            margin-top: 10px;
            z-index: 11;
        }
        
        .slideshow-controls-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 300px;
            margin: 0 auto;
            padding: 5px 0;
        }

        /* Single image download button in slideshow */
        .slideshow-download-button {
            background-color: #34A853;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: 15px;
        }

        .slideshow-download-button:hover {
            background-color: #2E8B57;
        }

        /* Hide console errors in UI */
        .error { display: block; }
    </style>
</head>
<script>
    // Add tab switching function
    document.addEventListener('DOMContentLoaded', function() {
        // Function to handle tab switching
        function switchTab(tabElement) {
            // Get the tab ID from the data attribute or ID
            const tabId = tabElement.getAttribute('data-tab') || tabElement.id.replace('tab-', '');
            
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to the selected tab and content
            tabElement.classList.add('active');
            document.getElementById('content-' + tabId).classList.add('active');
        }
        
        // Add click event listeners to tabs
        document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', function() { switchTab(this); }));
    });

    // Global variables
    let processedZip = null;
    let fileInput = null;
    
    // Slideshow globals
    let processedImages = [];
    let currentImageIndex = 0;
    let touchStartX = 0;
    let touchStartY = 0;
    let minSwipeDistance = 50; // Minimum distance to register as a swipe
</script>
<body>
    <div class="container">
        <h1><img src="favicon.ico" alt="Icon" style="height: 1.5em; width: auto; vertical-align: middle; margin-right: 0.5em;">Image Padder</h1>
        
        <!-- SEO-friendly description -->
        <div style="text-align: center; margin-bottom: 20px; max-width: 800px; margin-left: auto; margin-right: auto;">
            <h2 style="font-size: 1.2rem; color: #666; font-weight: normal; margin-bottom: 8px;">Add Padding to Images While Preserving Original Resolution</h2>
            <p style="color: #777; font-size: 0.95rem; line-height: 1.5;">
                Quickly add space around your images with custom padding or pad to specific aspect ratios like 16:9, 4:3, 1:1 square, and more. Perfect for social media posts, video thumbnails, and printing.
            </p>
        </div>
        
        <div id="error-message" class="error"></div>
        
        <div class="app-layout">
            <div class="controls-panel">
                <div class="form-group">
                    <h3 class="section-title">1. Select Image(s)</h3>
                    <div class="custom-file-input">
                        <label class="custom-file-input-label">
                            <i class="fas fa-upload"></i>
                            <span id="file-label" class="no-file">Choose image file(s)</span>
                            <input type="file" id="file-input" accept="image/*" multiple>
                        </label>
                    </div>
                    <!-- Container for displaying selected file names -->
                    <div id="selected-files-list" style="display: none; margin-top: 10px; max-height: 150px; overflow-y: auto; border: 1px solid #eee; border-radius: 4px; padding: 8px; font-size: 0.9rem;"></div>
                </div>

                <div class="form-group">
                    <h3 class="section-title">2. Set Parameters</h3>
                    
                    <div class="tabs">
                        <div class="tab active" id="tab-aspect-ratio" data-target="content-aspect-ratio">Aspect Ratio</div>
                        <div class="tab" id="tab-custom-padding" data-target="content-custom-padding">Custom Padding</div>
                    </div>
                    
                    <div class="tab-content active" id="content-aspect-ratio">
                        <!-- Simplified aspect ratio fields -->
                        <div class="custom-ratio-container">
                            <label for="ratio-width" class="ratio-label">width:height</label>
                            <input type="number" id="ratio-width" min="1" value="1" class="ratio-input" style="text-align: center;">
                            <div class="ratio-separator">:</div>
                            <input type="number" id="ratio-height" min="1" value="1" class="ratio-input" style="text-align: center;">
                        </div>
                        
                        <!-- Secondary preset dropdown -->
                        <div class="aspect-ratio-selection">
                            <label for="aspect-ratio-preset">Or choose a common ratio:</label>
                            <select id="aspect-ratio-preset" class="aspect-ratio-preset">
                                <option value="custom" selected>Custom</option>
                                <option value="16:9">16:9 (Widescreen)</option>
                                <option value="4:3">4:3 (Standard)</option>
                                <option value="1:1">1:1 (Square)</option>
                                <option value="3:2">3:2 (Classic Photo)</option>
                                <option value="21:9">21:9 (Ultrawide)</option>
                                <option value="9:16">9:16 (Vertical Video)</option>
                                <option value="2:3">2:3 (Portrait Photo)</option>
                            </select>
                        </div>
                        
                        <!-- Hidden field for compatibility with existing code -->
                        <input type="hidden" id="aspect-ratio" value="1x1">
                    </div>
                    
                    <div class="tab-content" id="content-custom-padding">
                        <div class="padding-vertical">
                            <div class="padding-row">
                                <label for="padding-top">Top Padding (px):</label>
                                <input type="number" id="padding-top" value="0" min="0">
                            </div>
                            <div class="padding-row">
                                <label for="padding-right">Right Padding (px):</label>
                                <input type="number" id="padding-right" value="0" min="0">
                            </div>
                            <div class="padding-row">
                                <label for="padding-bottom">Bottom Padding (px):</label>
                                <input type="number" id="padding-bottom" value="0" min="0">
                            </div>
                            <div class="padding-row">
                                <label for="padding-left">Left Padding (px):</label>
                                <input type="number" id="padding-left" value="0" min="0">
                            </div>
                        </div>
                    </div>
                    
                    <div class="color-picker-container">
                        <div>
                        <label for="bg-color">Background Color:</label>
                            <span class="color-picker-hint">Click rectangle to open color selector</span>
                        </div>
                        <input type="color" id="bg-color" value="#FFFFFF" title="Click to open color picker">
                        <div class="color-preview" id="color-preview" style="background-color: #FFFFFF;"></div>
                        <span class="color-hex" id="color-hex">#FFFFFF</span>
                    </div>

                    <!-- Replace the transparency checkbox and opacity control with just opacity control -->
                    <div class="opacity-control" style="display:block; margin-top: 15px; margin-left: 0;">
                        <div class="transparency-option" style="margin-left: 0; margin-bottom: 10px;">
                            <input type="checkbox" id="transparent-bg">
                            <label for="transparent-bg">Fully transparent background (0% opacity)</label>
                </div>
                
                        <div style="display: flex; align-items: center;">
                            <label for="opacity-slider"><strong>Adjust Background Opacity:</strong></label>
                        </div>
                        <div class="opacity-slider-container">
                            <input type="range" id="opacity-slider" class="opacity-slider" min="0" max="100" value="100">
                            <span id="opacity-value" class="opacity-value">100%</span>
                        </div>
                        <div id="zero-opacity-hint" class="transparency-hint" style="display:none; margin-left: 0;">
                            Background color will be ignored since opacity is 0
                        </div>
                    </div>
                </div>
                
                <button id="process-button">Pad Image(s)</button>
                <div id="loading-spinner" class="loading-spinner" style="display:none;">
                    <div class="spinner"></div>
                    <div class="loading-text">Processing image...</div>
                </div>
            </div>
            
            <div class="result-panel">
                <div id="result-placeholder" class="placeholder-message">
                    <p>Your padded image will appear here</p>
                    <p><i class="fas fa-image fa-3x"></i></p>
                </div>
                
                <div id="image-container" class="image-container" style="display:none; flex-direction: column;">
                    <!-- Download button above the image -->
                    <div style="margin-bottom: 15px; width: 100%; display: flex; justify-content: center; align-items: center;">
                        <a id="download-link" class="download-button" href="#" onclick="handleDownload(event)">
                            <i class="fas fa-download"></i>
                            <span style="flex: 1; text-align: center;">Download All</span>
                        </a>
                    </div>
                    
                    <div class="image-wrapper">
                        <img id="result-image" />
                        <div id="slideshow-controls" style="display: none; backdrop-filter: blur(5px);" class="swipe-controls">
                            <div class="slideshow-controls-inner">
                                <div style="display: flex; justify-content: center; align-items: center; width: 100%;">
                                    <button id="prev-image" class="slideshow-button" style="background: transparent; color: white; border: none; font-size: 20px; cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    
                                    <div style="display: flex; align-items: center; margin: 0 10px;">
                                        <span id="image-counter" style="color: white; font-size: 14px; font-weight: bold; padding: 5px 10px; background: rgba(0,0,0,0.3); border-radius: 12px; min-width: 60px; text-align: center;">1/1</span>
                                        
                                        <!-- Single image download button -->
                                        <button id="download-current-image" class="slideshow-download-button" onclick="downloadCurrentImage(event)">
                                            <i class="fas fa-download"></i>
                                            <span>Download</span>
                                        </button>
                                    </div>
                                    
                                    <button id="next-image" class="slideshow-button" style="background: transparent; color: white; border: none; font-size: 20px; cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>                        
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="donation-section">
            <div class="donation-title">Find this tool useful? Consider supporting the development!</div>
            <div class="donation-buttons">
                <a href="https://paypal.me/amitjoshi168" target="_blank" class="donation-button paypal-button">
                    <i class="fab fa-paypal"></i> PayPal
                </a>
                <a href="https://venmo.com/Amit-Joshi-11" target="_blank" class="donation-button venmo-button">
                    <i class="fab fa-vimeo-v"></i> Venmo
                </a>
                <a href="https://ko-fi.com/amitjoshi24" target="_blank" class="donation-button ko-fi-button">
                    <i class="fas fa-coffee"></i> Ko-fi
                </a>
                <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
                <script type='text/javascript'>kofiwidget2.init('Support me on Ko-fi', '#f57373', 'I2I81CDN0L');kofiwidget2.draw();</script>
            </div>
        </div>
        
        
        <div class="credits">
            Credits: Amit Joshi (<a href="https://github.com/amitjoshi24" target="_blank">@amitjoshi24</a>) 
            and Jeffrey Wang (<a href="https://github.com/jeffw16" target="_blank">@jeffw16</a>)
        </div>
    </div>

    <script>
    // Add this at the beginning of your HTML body
    document.addEventListener('DOMContentLoaded', function() {
        // Add a flag to track if we're in the middle of a hack
        let isHackInProgress = false;
        
        // Check if we're on a mobile device
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        
        // Tab switching function that works for both click and touch
        function switchTab(tab) {
            // Get the target content ID from the data-target attribute
            const targetId = tab.getAttribute('data-target');
            
            // Skip if we're in the middle of a hack and this is a simulated click
            if (isHackInProgress && targetId === 'content-custom-padding') {
                return;
            }
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Deactivate all tabs
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
            });
            
            // Activate the clicked tab
                tab.classList.add('active');
                
            // Show the target content
            document.getElementById(targetId).classList.add('active');
            
            // Only run the hack if not on mobile and it's the custom padding tab
            if (!isMobile && targetId === 'content-custom-padding' && !isHackInProgress) {
                // Set the flag to indicate we're in a hack
                isHackInProgress = true;
                
                // Get the aspect ratio tab
                const aspectRatioTab = document.querySelector('.tab[data-target="content-aspect-ratio"]');
                const customPaddingTab = tab;
                
                // Click aspect ratio tab
                switchTab(aspectRatioTab);
                
                // Then switch back to custom padding tab after a short delay
                setTimeout(() => {
                    switchTab(customPaddingTab);
                    // Reset the hack flag
                    isHackInProgress = false;
                }, 10);
            }
        }
        
        // Add click event listeners to tabs
        document.querySelectorAll('.tab').forEach(tab => {
            // For mouse clicks
            tab.addEventListener('click', function() {
                switchTab(this);
            });
            
            // For touch events on mobile
            if (isMobile) {
                tab.addEventListener('touchend', function(e) {
                    e.preventDefault(); // Prevent default touch behavior
                    switchTab(this);
                });
            }
        });
        
        // Rest of your mobile warning code
        if (isMobile) {
            const mobileWarning = document.createElement('div');
            mobileWarning.style.padding = '10px';
            mobileWarning.style.backgroundColor = '#FFF3CD';
            mobileWarning.style.color = '#856404';
            mobileWarning.style.borderRadius = '4px';
            mobileWarning.style.margin = '10px 0';
            mobileWarning.style.textAlign = 'center';
            mobileWarning.innerHTML = 'For best experience, use a desktop browser. Mobile support is limited.';
            
            const container = document.querySelector('.container');
            container.insertBefore(mobileWarning, container.firstChild);
        }

        // Function to handle opacity slider changes
        function handleOpacityChange() {
            const opacitySlider = document.getElementById('opacity-slider');
            const opacityValue = document.getElementById('opacity-value');
            const transparentCheckbox = document.getElementById('transparent-bg');
            const value = opacitySlider.value;
            
            // Update the displayed value
            opacityValue.textContent = value + '%';
            
            // Update checkbox state based on slider value
            transparentCheckbox.checked = (value === '0');
            
            // Update color picker visibility based on opacity
            const isZeroOpacity = value === '0';
            const colorInput = document.getElementById('bg-color');
            const colorPreview = document.getElementById('color-preview');
            const colorHex = document.getElementById('color-hex');
            const colorPickerHint = document.querySelector('.color-picker-hint');
            const colorLabel = document.querySelector('.color-picker-container label');
            const zeroOpacityHint = document.getElementById('zero-opacity-hint');
            
            colorInput.style.opacity = isZeroOpacity ? '0.5' : '1';
            colorPreview.style.opacity = isZeroOpacity ? '0.5' : '1';
            colorHex.style.opacity = isZeroOpacity ? '0.5' : '1';
            colorPickerHint.style.opacity = isZeroOpacity ? '0.5' : '1';
            colorLabel.style.opacity = isZeroOpacity ? '0.5' : '1';
            
            // Show/hide zero opacity hint
            zeroOpacityHint.style.display = isZeroOpacity ? 'block' : 'none';
        }

        // Add event listener for checkbox
        const transparentCheckbox = document.getElementById('transparent-bg');
        transparentCheckbox.addEventListener('change', function() {
            const opacitySlider = document.getElementById('opacity-slider');
            
            // If checkbox is checked, set slider to 0
            if (this.checked) {
                opacitySlider.value = 0;
            } else {
                // If unchecked and slider is already 0, set to 100
                if (opacitySlider.value === '0') {
                    opacitySlider.value = 100;
                }
            }
            
            // Update everything based on the new slider value
            handleOpacityChange();
        });

        // Keep existing event listener for slider
        const opacitySlider = document.getElementById('opacity-slider');
        opacitySlider.addEventListener('input', handleOpacityChange);

        // Initialize on page load
        handleOpacityChange();

        // File input styling
        const fileInput = document.getElementById('file-input');
        const fileLabel = document.getElementById('file-label');

        fileInput.addEventListener('change', function() {
            if(this.files && this.files.length > 0) {
                fileLabel.textContent = this.files[0].name;
                fileLabel.classList.remove('no-file');
            } else {
                fileLabel.textContent = 'Choose image file(s)';
                fileLabel.classList.add('no-file');
            }
        });

        // Aspect ratio preset handling
        const aspectRatioPreset = document.getElementById('aspect-ratio-preset');
        const customRatioInputs = document.getElementById('custom-ratio-inputs');
        const ratioWidth = document.getElementById('ratio-width');
        const ratioHeight = document.getElementById('ratio-height');

        // Set initial values based on the default 4x3 value
        const initialRatio = document.getElementById('aspect-ratio').value.split('x');
        if (initialRatio.length === 2) {
            ratioWidth.value = initialRatio[0];
            ratioHeight.value = initialRatio[1];
        }

        // Handle preset selection
        aspectRatioPreset.addEventListener('change', function() {
            if (this.value === 'custom') {
                // Don't change the width/height fields for custom option
            } else {
                // Parse the selected ratio (e.g., "16:9")
                const [width, height] = this.value.split(':');
                
                // Update the width and height input fields
                ratioWidth.value = width;
                ratioHeight.value = height;
                
                // Update the hidden input used by the processing code
                document.getElementById('aspect-ratio').value = width + 'x' + height;
            }
        });

        // Handle custom ratio input changes
        ratioWidth.addEventListener('input', updateCustomRatio);
        ratioHeight.addEventListener('input', updateCustomRatio);

        function updateCustomRatio() {
            // Update the hidden aspect ratio field
            document.getElementById('aspect-ratio').value = ratioWidth.value + 'x' + ratioHeight.value;
            
            // Set the dropdown to "Custom" when manually changing width/height
            aspectRatioPreset.value = "custom";
        }

        // Add color picker functionality
        const colorPreview = document.getElementById('color-preview');
        const colorHex = document.getElementById('color-hex');
        
        // Update color preview and hex display when color changes
        const bgColorInput = document.getElementById('bg-color');
        bgColorInput.addEventListener('input', updateColorPreview);
        
        // Initial color preview update
        updateColorPreview();
        
        // Function to update the color preview and hex code
        function updateColorPreview() {
            const selectedColor = bgColorInput.value;
            colorPreview.style.backgroundColor = selectedColor;
            colorHex.textContent = selectedColor.toUpperCase();
        }
        
        // Show/hide opacity slider based on transparency checkbox
        document.getElementById('transparent-bg').addEventListener('change', function() {
            document.getElementById('opacity-container').style.display = this.checked ? 'block' : 'none';
        });
    });

    // Direct approach to spinner management
    document.addEventListener('DOMContentLoaded', function() {
        // Clear any existing click handlers on the process button
        const processButton = document.getElementById('process-button');
        const newProcessButton = processButton.cloneNode(true);
        processButton.parentNode.replaceChild(newProcessButton, processButton);
        
        // Add our clean click handler
        newProcessButton.addEventListener('click', function() {
            console.log("Process button clicked - showing spinner");
            document.getElementById('loading-spinner').style.display = 'block';
        });
        
        // Expose a global function to hide the spinner
        window.hideSpinner = function() {
            console.log("Hiding spinner");
            document.getElementById('loading-spinner').style.display = 'none';
        };
    });

    // Image processing implementation
    document.addEventListener('DOMContentLoaded', function() {
        // Get UI elements
        const fileInput = document.getElementById('file-input');
        const processButton = document.getElementById('process-button');
        const errorMessage = document.getElementById('error-message');
        const resultImage = document.getElementById('result-image');
        const resultPlaceholder = document.getElementById('result-placeholder');
        const imageContainer = document.getElementById('image-container');
        const downloadLink = document.getElementById('download-link');
        const bgColorInput = document.getElementById('bg-color');
        const selectedFilesList = document.getElementById('selected-files-list');
        const slideshowControls = document.getElementById('slideshow-controls');
        const prevImageBtn = document.getElementById('prev-image');
        const nextImageBtn = document.getElementById('next-image');
        const transparentBgCheckbox = document.getElementById('transparent-bg');
        const opacitySlider = document.getElementById('opacity-slider');

        // Set up tab switching
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(function(tab) {
            tab.addEventListener('click', function() {
                // Get the tab ID from the data attribute or ID
                const tabId = this.getAttribute('data-tab') || this.id.replace('tab-', '');
                
                // Remove active class from all tabs and contents
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to the selected tab and content
                this.classList.add('active');
                const contentElement = document.getElementById('content-' + tabId);
                if (contentElement) contentElement.classList.add('active');
            });
        });

        // Process button click handler
        processButton.addEventListener('click', function() {
            processImage();
            // Always hide slideshow controls initially
            slideshowControls.style.display = 'none';
        });

        // Reset UI when loading new images
        function resetUI() {
            processedImages = [];
            slideshowControls.style.display = 'none';
        }

        // Main image processing function
        async function processImage() {
            errorMessage.textContent = '';
            
            try {
                // Check if a file is selected
                if (fileInput.files.length === 0) {
                    throw new Error('Please select an image file.');
                }
                
                resetUI();
                
                // Show the spinner
                document.getElementById('loading-spinner').style.display = 'block';
                
                // Check if we're processing one or multiple files
                if (fileInput.files.length === 1) {
                    // Single file processing
                    const file = fileInput.files[0];
                    
                    // Process the image
                    const processedImageDataUrl = await padImage(file);
                    
                    // Store in a single-item zip for consistent download behavior
                    processedZip = await createZipWithSingleImage(file.name, processedImageDataUrl);
                    
                    // Set download handler for single image
                    downloadLink.onclick = handleDownload;
                    
                    // Display the processed image
                    resultImage.src = processedImageDataUrl;
                    downloadLink.href = processedImageDataUrl;
                    downloadLink.download = `padded_${file.name}`;
                    
                    // Hide placeholder, show image
                    resultPlaceholder.style.display = 'none';
                    imageContainer.style.display = 'block';
                } else {
                    // Multiple files - We'll need JSZip
                    await loadJSZip();
                    
                    // Update placeholder to show we're processing multiple files
                    resultPlaceholder.style.display = 'block';
                    resultPlaceholder.innerHTML = '<p>Processing multiple files...</p><p><i class="fas fa-cog fa-spin fa-3x"></i></p>';
                    imageContainer.style.display = 'none';
                    
                    // Reset processed images array
                    processedImages = [];
                    currentImageIndex = 0;
                    
                    // Create a new zip file
                    const zip = new JSZip();
                    let processedCount = 0;
                    
                    // Process each file
                    for (let i = 0; i < fileInput.files.length; i++) {
                        const file = fileInput.files[i];
                        try {
                            // Update progress in placeholder
                            resultPlaceholder.innerHTML = `<p>Processing file ${i+1} of ${fileInput.files.length}...</p><p><i class="fas fa-cog fa-spin fa-3x"></i></p>`;
                            
                            // Process the image
                            const processedImageDataUrl = await padImage(file);
                            
                            // Store in our slideshow array
                            processedImages.push({
                                url: processedImageDataUrl,
                                name: file.name
                            });
                            // Add the processed image to the zip
                            const base64Data = processedImageDataUrl.split(',')[1];
                            zip.file(`padded_${file.name}`, base64Data, {base64: true});
                            processedCount++;
                        } catch (err) {
                            console.error(`Error processing file ${file.name}:`, err);
                        }
                    }
                    
                    if (processedCount > 0) {
                        // Store the generated zip for download button instead of auto-downloading
                        resultPlaceholder.innerHTML = `<p>Creating ZIP file with ${processedCount} images...</p><p><i class="fas fa-archive fa-3x"></i></p>`;
                        processedZip = zip;
                        
                        // Show the first processed image in a slideshow
                        resultPlaceholder.style.display = 'none';
                        imageContainer.style.display = 'block';
                        imageContainer.style.display = 'flex';  // Make sure it's using flex
                        if (processedImages.length > 0) {
                            showImageAtIndex(0);
                            slideshowControls.style.display = processedImages.length > 1 ? 'block' : 'none';
                            document.getElementById('image-counter').textContent = `1/${processedImages.length}`;
                            
                            // Set up touch swipe for mobile if we have multiple images
                            if (processedImages.length > 1) {
                                setupSwipeGestures();
                            }
                        }

                        errorMessage.style.color = '#4285F4';
                        errorMessage.textContent = `Successfully processed ${processedCount} images. Click Download All to save.`;
                    } else {
                        throw new Error('No images could be processed. Please check your files and try again.');
                    }
                }
            } catch (error) {
                console.error('Error processing image:', error);
                errorMessage.textContent = error.message || 'Error processing image';
                errorMessage.style.color = 'red';
                resultPlaceholder.innerHTML = '<p>Your padded image will appear here</p><p><i class="fas fa-image fa-3x"></i></p>';
            } finally {
                // Hide the spinner
                window.hideSpinner();
            }
        }
        
        // Function to pad an image with the selected parameters
        async function padImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = new Image();
                    
                    img.onload = function() {
                        try {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            // Get original dimensions
                            const width = img.width;
                            const height = img.height;
                            
                            // Get background color
                            const bgColorHex = bgColorInput.value;
                            
                            // Convert hex to RGB
                            const r = parseInt(bgColorHex.slice(1, 3), 16);
                            const g = parseInt(bgColorHex.slice(3, 5), 16);
                            const b = parseInt(bgColorHex.slice(5, 7), 16);
                            
                            // Get transparency settings
                            const useTransparentBg = transparentBgCheckbox.checked;
                            const opacity = parseInt(opacitySlider.value) / 100;
                            
                            // Determine which mode is active: aspect ratio or custom padding
                            const isAspectRatioMode = document.getElementById('content-aspect-ratio').classList.contains('active');
                            
                            let newWidth, newHeight, offsetX, offsetY;
                            
                            if (isAspectRatioMode) {
                                // Get aspect ratio
                                const aspectRatioInput = document.getElementById('aspect-ratio').value;
                                let nw, nh;
                                
                                try {
                                    const parts = aspectRatioInput.split('x');
                                    if (parts.length !== 2) {
                                        throw new Error('Invalid format');
                                    }
                                    
                                    nw = parseInt(parts[0]);
                                    nh = parseInt(parts[1]);
                                    
                                    if (isNaN(nw) || isNaN(nh) || nw <= 0 || nh <= 0) {
                                        throw new Error('Invalid values');
                                    }
                                } catch (e) {
                                    reject(new Error('Invalid aspect ratio. Must be in the format WIDTHxHEIGHT, e.g. 4x3.'));
                                    return;
                                }
                                
                                // Determine whether to pad vertically or horizontally
                                const verticalPad = (nw / nh) <= (width / height);
                                
                                if (verticalPad) {
                                    newWidth = width;
                                    newHeight = Math.ceil(width * nh / nw);
                                    offsetX = 0;
                                    offsetY = Math.floor((newHeight - height) / 2);
                                } else {
                                    newWidth = Math.ceil(height * nw / nh);
                                    newHeight = height;
                                    offsetX = Math.floor((newWidth - width) / 2);
                                    offsetY = 0;
                                }
                            } else {
                                // Custom padding mode
                                try {
                                    const paddingTop = parseInt(document.getElementById('padding-top').value) || 0;
                                    const paddingRight = parseInt(document.getElementById('padding-right').value) || 0;
                                    const paddingBottom = parseInt(document.getElementById('padding-bottom').value) || 0;
                                    const paddingLeft = parseInt(document.getElementById('padding-left').value) || 0;
                                    
                                    if (paddingTop < 0 || paddingRight < 0 || paddingBottom < 0 || paddingLeft < 0) {
                                        throw new Error('Negative values');
                                    }
                                    
                                    newWidth = width + paddingLeft + paddingRight;
                                    newHeight = height + paddingTop + paddingBottom;
                                    offsetX = paddingLeft;
                                    offsetY = paddingTop;
                                } catch (e) {
                                    reject(new Error('Invalid padding values. Please enter positive numbers.'));
                                    return;
                                }
                            }
                            
                            // Set canvas dimensions
                            canvas.width = newWidth;
                            canvas.height = newHeight;
                            
                            // Fill background with color (and transparency if selected)
                            ctx.clearRect(0, 0, newWidth, newHeight);
                            
                            if (useTransparentBg) {
                                ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                            } else {
                                ctx.fillStyle = bgColorHex;
                            }
                            
                            ctx.fillRect(0, 0, newWidth, newHeight);
                            
                            // Draw the original image at the calculated position
                            ctx.drawImage(img, offsetX, offsetY);
                            
                            // Convert to data URL
                            const dataUrl = canvas.toDataURL('image/png');
                            resolve(dataUrl);
                            
                        } catch (error) {
                            reject(new Error('Error processing image: ' + error.message));
                        }
                    };
                    
                    img.onerror = function() {
                        reject(new Error('Failed to load image. The file may not be a valid image.'));
                    };
                    
                    img.src = e.target.result;
                };
                
                reader.onerror = function() {
                    reject(new Error('Error reading file.'));
                };
                
                reader.readAsDataURL(file);
            });
        }
        
        // Function to display image at specific index in slideshow
        function showImageAtIndex(index) {
            if (!processedImages.length || index < 0 || index >= processedImages.length) return;
            
            currentImageIndex = index;
            const image = processedImages[index];
            
            resultImage.src = image.url;
            downloadLink.href = image.url;
            downloadLink.download = `padded_${image.name}`;
            
            // Update counter
            document.getElementById('image-counter').textContent = `${index + 1}/${processedImages.length}`;
            
            // Enable/disable navigation buttons
            prevImageBtn.disabled = index === 0;
            nextImageBtn.disabled = index === processedImages.length - 1;
        }
        
        // Slideshow navigation
        prevImageBtn.addEventListener('click', function() {
            if (currentImageIndex > 0) {
                showImageAtIndex(currentImageIndex - 1);
            }
        });
        
        nextImageBtn.addEventListener('click', function() {
            if (currentImageIndex < processedImages.length - 1) {
                showImageAtIndex(currentImageIndex + 1);
            }
        });
        
        // Update aspect ratio when preset is selected
        document.getElementById('aspect-ratio-preset').addEventListener('change', function() {
            const preset = this.value;
            if (preset !== 'custom') {
                const [width, height] = preset.split(':');
                document.getElementById('ratio-width').value = width;
                document.getElementById('ratio-height').value = height;
                document.getElementById('aspect-ratio').value = width + 'x' + height;
            }
        });
        
        // Update displayed filename when files are selected
        fileInput.addEventListener('change', function() {
            // Reset touch handlers on new file selection
            const imageElement = document.getElementById('result-image');
            if (imageElement) {
                imageElement.removeEventListener('touchstart', null);
                imageElement.removeEventListener('touchend', null);
            }
            const fileLabel = document.getElementById('file-label');
            
            // Clear any previous messages and file list
            selectedFilesList.innerHTML = '';
            selectedFilesList.style.display = 'none';
            errorMessage.textContent = '';
            slideshowControls.style.display = 'none';
            
            if (this.files.length === 0) {
                fileLabel.textContent = 'Choose image file(s)';
                processButton.textContent = 'Pad Image(s)';
                slideshowControls.style.display = 'none';
            } else if (this.files.length > 1) {
                fileLabel.textContent = `${this.files.length} files selected`;
                fileLabel.classList.remove('no-file');
                processButton.textContent = 'Pad Image(s)';
                
                // Display all file names in the scrollable list
                selectedFilesList.style.display = 'block';
                
                // Create a stylized list of files
                const fileList = document.createElement('ul');
                fileList.style.listStyle = 'none';
                fileList.style.padding = '0';
                fileList.style.margin = '0';
                
                for (let i = 0; i < this.files.length; i++) {
                    const item = document.createElement('li');
                    item.style.padding = '4px 0';
                    item.style.borderBottom = i < this.files.length - 1 ? '1px solid #eee' : 'none';
                    item.innerHTML = `<i class="fas fa-image" style="color: #4285F4; margin-right: 8px;"></i> ${this.files[i].name}`;
                    fileList.appendChild(item);
                }
                
                selectedFilesList.appendChild(fileList);
            } else if (this.files.length === 1) {
                fileLabel.textContent = this.files[0].name;
                fileLabel.classList.remove('no-file');
                processButton.textContent = 'Pad Image(s)';
                // Reset processed images for slideshow
                processedImages = [];
                currentImageIndex = 0;
            } else {
                fileLabel.textContent = 'Multiple files selected';
                fileLabel.classList.remove('no-file');
                
                // Display all file names in the scrollable list
                selectedFilesList.style.display = 'block';
                
                // Create a stylized list of files
                const fileList = document.createElement('ul');
                fileList.style.listStyle = 'none';
                fileList.style.padding = '0';
                fileList.style.margin = '0';
                
                for (let i = 0; i < this.files.length; i++) {
                    const item = document.createElement('li');
                    item.style.padding = '4px 0';
                    item.style.borderBottom = i < this.files.length - 1 ? '1px solid #eee' : 'none';
                    item.innerHTML = `<i class="fas fa-image" style="color: #4285F4; margin-right: 8px;"></i> ${this.files[i].name}`;
                    fileList.appendChild(item);
                }
                
                selectedFilesList.appendChild(fileList);
            }
        });

        // Add keyboard navigation for slideshow (left/right arrows)
        document.addEventListener('keydown', function(e) {
            if (!processedImages.length || processedImages.length <= 1) return;
            if (e.key === 'ArrowLeft' && currentImageIndex > 0) showImageAtIndex(currentImageIndex - 1);
            if (e.key === 'ArrowRight' && currentImageIndex < processedImages.length - 1) showImageAtIndex(currentImageIndex + 1);
        });
    });

    // Function to load JSZip library dynamically
    async function loadJSZip() {
        return new Promise((resolve, reject) => {
            if (window.JSZip) {
                resolve();
                return;
            }
            
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
            script.onload = () => resolve();
            script.onerror = () => reject(new Error('Failed to load JSZip. Check your internet connection.'));
            document.head.appendChild(script);
        });
    }

    // Function to create a zip with a single image
    async function createZipWithSingleImage(filename, dataUrl) {
        await loadJSZip();
        const zip = new JSZip();
        const base64Data = dataUrl.split(',')[1];
        zip.file(`padded_${filename}`, base64Data, {base64: true});
        return zip;
    }

    // Function to handle the download of multiple images
    async function handleDownload(e) {
        e.preventDefault();
        
        // Make sure fileInput is available
        if (!fileInput) {
            fileInput = document.getElementById('file-input');
            if (!fileInput) {
                const errorMessage = document.getElementById('error-message');
                if (errorMessage) errorMessage.textContent = 'File input not found. Please try again.';
                return false;
            }
        }
        
        const errorMessage = document.getElementById('error-message');

        if (!processedZip) {
            if (errorMessage) errorMessage.textContent = 'No processed images to download.';
            return false;
        }

        try {
            // Create download link
            const link = document.createElement('a');
            
            // Handle single vs multiple files
            if (fileInput.files.length === 1) {
                // Process single file download
                const resultImage = document.getElementById('result-image');
                link.href = resultImage.src;
                link.download = `padded_${fileInput.files[0].name}`;
            } else {
                // Process zip download
                const zipBlob = await processedZip.generateAsync({type: 'blob'});
                link.href = URL.createObjectURL(zipBlob);
                link.download = 'padded_images.zip';
            }

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            return false;
        } catch (error) {
            console.error('Download error:', error);
            if (errorMessage) errorMessage.textContent = 'Error creating download: ' + error.message;
            return false;
        }
    }

    // Function to download just the current image in the slideshow
    function downloadCurrentImage(e) {
        e.preventDefault();
        
        // Make sure we have an image to download
        if (!processedImages || !processedImages.length || currentImageIndex < 0 || currentImageIndex >= processedImages.length) {
            return false;
        }
        
        // Get the current image from the slideshow
        const currentImage = processedImages[currentImageIndex];
        
        // Create a download link for just this image
        const link = document.createElement('a');
        link.href = currentImage.url;
        link.download = `padded_${currentImage.name}`;
        link.click();
    }

    // Function to set up swipe gestures for mobile
    function setupSwipeGestures() {
        const imageElement = document.getElementById('result-image');
        
        // Touch start event to record the starting position
        imageElement.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });
        
        // Touch end event to determine if it was a swipe and in which direction
        imageElement.addEventListener('touchend', function(e) {
            const touchEndX = e.changedTouches[0].screenX;
            const touchEndY = e.changedTouches[0].screenY;
            
            // Calculate horizontal and vertical distance
            const distX = touchStartX - touchEndX;
            const distY = touchStartY - touchEndY;
            
            // Check if horizontal swipe is more significant than vertical
            if (Math.abs(distX) > Math.abs(distY) && Math.abs(distX) > minSwipeDistance) {
                // Determine direction
                if (distX > 0) {
                    // Swipe left - next image
                    if (currentImageIndex < processedImages.length - 1) {
                        showImageAtIndex(currentImageIndex + 1);
                    }
                } else {
                    // Swipe right - previous image
                    if (currentImageIndex > 0) {
                        showImageAtIndex(currentImageIndex - 1);
                    }
                }
            }
        }, { passive: true });
    }

    // Add visual feedback for swipe gestures
    document.addEventListener('DOMContentLoaded', function() {
        const resultImage = document.getElementById('result-image');
        
        // Show/hide swipe hint on mobile devices
        if ('ontouchstart' in window && resultImage) {
            // Create a swipe hint overlay
            const swipeHint = document.createElement('div');
            swipeHint.innerHTML = '<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; padding: 10px 20px; border-radius: 20px; font-size: 14px; pointer-events: none; z-index: 100; opacity: 0.8;">Swipe to navigate</div>';
            swipeHint.style.position = 'absolute';
            swipeHint.style.top = '0';
            swipeHint.style.left = '0';
            swipeHint.style.width = '100%';
            swipeHint.style.height = '100%';
            swipeHint.style.display = 'none';
        }
    });
    </script>
</body>
</html>